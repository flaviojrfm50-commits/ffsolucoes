<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Super Admin | FF SoluÃ§Ãµes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#020617;color:#fff}
.container{max-width:1200px;margin:40px auto;padding:30px;border-radius:20px;background:linear-gradient(135deg,#0f172a,#4b1fa0)}
h1,h2,h3{margin-top:25px}
button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:bold}
button.block{background:#f59e0b;color:#000}
button.ok{background:#22c55e;color:#000}
button.danger{background:#e53935;color:#fff}
.card{
  background:#020617;
  padding:16px;
  margin-top:12px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px
}
.badge{background:#334155;padding:4px 8px;border-radius:6px;font-size:12px}
.badge.red{background:#7c2d12}
a{color:#22c55e;text-decoration:none}
.login{max-width:420px;margin:80px auto}
</style>
</head>

<body>
<div class="container">

<h1>ğŸ‘‘ Super Admin â€” FF SoluÃ§Ãµes</h1>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <input id="usuarioSuper" placeholder="UsuÃ¡rio"><br><br>
  <input id="senhaSuper" type="password" placeholder="Senha"><br><br>
  <button class="ok" onclick="login()">Entrar</button>
</div>

<!-- PAINEL -->
<div id="painel" style="display:none">

<h2>ğŸ¢ NegÃ³cios (com vendedor)</h2>
<div id="listaNegocios"></div>

<hr style="margin:40px 0">

<h2>ğŸ’° Vendedores</h2>
<div id="listaVendedores"></div>

</div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

/* LOGIN */
window.login = async ()=>{
  const { data } = await supabase
    .from("super_admins")
    .select("*")
    .eq("usuario", usuarioSuper.value)
    .eq("senha", senhaSuper.value)
    .eq("ativo", true)
    .maybeSingle();

  if(!data) return alert("Login invÃ¡lido");

  loginBox.style.display="none";
  painel.style.display="block";
  carregarNegocios();
  carregarVendedores();
};

/* ===== NEGÃ“CIOS ===== */
async function carregarNegocios(){
  const { data, error } = await supabase
    .from("apps")
    .select(`
      id,
      nome,
      tipo,
      ativo,
      vendedor_id,
      usuarios (
        id,
        nome
      )
    `);

  if(error){
    console.error(error);
    alert("Erro ao carregar negÃ³cios");
    return;
  }

  listaNegocios.innerHTML = "";

  data.forEach(n=>{
    const vendedor = n.usuarios?.nome || "â€”";

    const link =
      n.tipo==="hotel"
      ? `https://anajuliafarias659-cloud.github.io/ffsolucoes/hotel/public/site/index.html?id=${n.id}`
      : n.tipo==="locadora"
      ? `https://anajuliafarias659-cloud.github.io/ffsolucoes/locadora/public/index.html?app_id=${n.id}`
      : n.tipo==="mercado"
      ? `https://anajuliafarias659-cloud.github.io/ffsolucoes/mercado/public/catalogo.html?app=${n.id}`
      : `https://anajuliafarias659-cloud.github.io/ffsolucoes/bar/public/cardapio/index.html?app=${n.id}`;

    listaNegocios.innerHTML += `
      <div class="card">
        <div>
          <b>${n.nome}</b> <span class="badge">${n.tipo}</span><br>
          <small>Criado por:</small> <b>${vendedor}</b><br>
          <small>Status:</small>
          ${n.ativo ? "ğŸŸ¢ ativo" : "<span class='badge red'>bloqueado</span>"}<br>
          <a href="${link}" target="_blank">ğŸŒ site pÃºblico</a>
        </div>

        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="block" onclick="toggleNegocio('${n.id}', ${n.ativo})">
            ${n.ativo ? "ğŸ”’ Bloquear" : "ğŸ”“ Desbloquear"}
          </button>

          <button class="danger" onclick="excluirNegocio('${n.id}')">
            ğŸ—‘ï¸ Excluir
          </button>
        </div>
      </div>
    `;
  });
}

window.toggleNegocio = async (id, ativo)=>{
  await supabase.from("apps").update({ativo: !ativo}).eq("id", id);
  carregarNegocios();
};

window.excluirNegocio = async id=>{
  if(!confirm("Excluir negÃ³cio definitivamente?")) return;
  await supabase.from("apps").delete().eq("id", id);
  carregarNegocios();
};

/* ===== VENDEDORES ===== */
async function carregarVendedores(){
  const { data } = await supabase
    .from("usuarios")
    .select("*")
    .eq("tipo","vendedor");

  listaVendedores.innerHTML = "";

  data.forEach(v=>{
    listaVendedores.innerHTML += `
      <div class="card">
        <div>
          <b>${v.nome}</b><br>
          <small>${v.email}</small><br>
          <span class="badge">ComissÃ£o ${v.comissao_percentual}%</span>
          ${!v.ativo ? `<span class="badge red">bloqueado</span>` : ""}
        </div>

        <button class="danger" onclick="excluirVendedor('${v.id}')">
          ğŸ—‘ï¸ Excluir
        </button>
      </div>
    `;
  });
}

window.excluirVendedor = async id=>{
  if(!confirm("Excluir vendedor definitivamente?")) return;
  await supabase.from("usuarios").delete().eq("id", id);
  carregarVendedores();
};
</script>

</body>
</html>
