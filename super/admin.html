<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ğŸ‘‘ Super Admin | FF SoluÃ§Ãµes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,system-ui,sans-serif;
  background:#020617;
  color:#fff;
}
.container{
  max-width:1200px;
  margin:40px auto;
  padding:30px;
  border-radius:20px;
  background:linear-gradient(135deg,#0f172a,#4b1fa0);
}
h1,h2,h3{margin-top:25px}
input,select,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:12px;
  border:none;
}
button{
  background:#22c55e;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
button.danger{background:#e53935;color:#fff}
button.warn{background:#f59e0b;color:#000}
.card{
  background:#020617;
  padding:16px;
  margin-top:12px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.login{max-width:420px;margin:80px auto}
hr{margin:40px 0;border:none;height:1px;background:rgba(255,255,255,.2)}
a{color:#22c55e;text-decoration:none}
.btn-small{
  width:auto;
  padding:6px 12px;
  font-size:12px;
  border-radius:8px;
}
.badge{
  background:#334155;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.badge.off{background:#7c2d12}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal .box{
  background:#020617;
  padding:20px;
  border-radius:16px;
  width:100%;
  max-width:420px;
}
</style>
</head>

<body>
<div class="container">

<h1>ğŸ‘‘ Super Admin â€” FF SoluÃ§Ãµes</h1>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <input id="usuarioSuper" placeholder="UsuÃ¡rio">
  <input id="senhaSuper" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<!-- PAINEL -->
<div id="painel" style="display:none">

<h2>ğŸ’° Vendedores</h2>
<div id="listaVendedores"></div>

</div>
</div>

<!-- MODAL EDITAR -->
<div class="modal" id="modalEditar">
  <div class="box">
    <h3>âœï¸ Editar Vendedor</h3>
    <input id="editNome" placeholder="Nome">
    <input id="editEmail" placeholder="Email">
    <input id="editSenha" type="password" placeholder="Nova senha (opcional)">
    <input id="editComissao" type="number" placeholder="ComissÃ£o %">
    <button onclick="salvarEdicao()">Salvar</button>
    <button class="warn" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

let vendedorEditando = null;

/* LOGIN */
window.login = async ()=>{
  const { data } = await supabase
    .from("super_admins")
    .select("*")
    .eq("usuario",usuarioSuper.value)
    .eq("senha",senhaSuper.value)
    .eq("ativo",true)
    .maybeSingle();

  if(!data) return alert("Login invÃ¡lido");

  loginBox.style.display="none";
  painel.style.display="block";
  carregarVendedores();
};

/* VENDEDORES */
async function carregarVendedores(){
  const { data } = await supabase
    .from("usuarios")
    .select("*")
    .eq("tipo","vendedor");

  listaVendedores.innerHTML="";

  (data||[]).forEach(v=>{
    listaVendedores.innerHTML += `
      <div class="card">
        <div>
          <b>${v.nome}</b><br>
          <small>${v.email}</small><br>
          <span class="badge">ComissÃ£o ${v.comissao_percentual}%</span>
          ${!v.ativo ? `<span class="badge off">Bloqueado</span>` : ``}
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn-small" onclick="abrirEditar('${v.id}')">âœï¸</button>
          <button class="btn-small warn" onclick="toggle('${v.id}',${v.ativo})">
            ${v.ativo ? "ğŸ”’" : "ğŸ”“"}
          </button>
          <button class="btn-small danger" onclick="excluir('${v.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  });
}

/* EDITAR */
window.abrirEditar = async id=>{
  const { data } = await supabase.from("usuarios").select("*").eq("id",id).single();
  vendedorEditando = id;
  editNome.value = data.nome;
  editEmail.value = data.email;
  editComissao.value = data.comissao_percentual;
  editSenha.value = "";
  modalEditar.style.display="flex";
};

window.salvarEdicao = async ()=>{
  const payload = {
    nome: editNome.value,
    email: editEmail.value,
    comissao_percentual: Number(editComissao.value)
  };
  if(editSenha.value) payload.senha = editSenha.value;

  await supabase.from("usuarios").update(payload).eq("id",vendedorEditando);
  fecharModal();
  carregarVendedores();
};

window.fecharModal = ()=> modalEditar.style.display="none";

/* BLOQUEAR */
window.toggle = async (id,ativo)=>{
  await supabase.from("usuarios").update({ativo:!ativo}).eq("id",id);
  carregarVendedores();
};

/* EXCLUIR */
window.excluir = async id=>{
  if(!confirm("Excluir vendedor? Essa aÃ§Ã£o nÃ£o pode ser desfeita.")) return;
  await supabase.from("usuarios").delete().eq("id",id);
  carregarVendedores();
};
</script>

</body>
</html>
