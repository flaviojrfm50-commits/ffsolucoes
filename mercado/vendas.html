<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Caixa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>

<style>
body{background:#020617;color:#fff;font-family:Arial;margin:0}
.box{padding:16px}
input,button{width:100%;padding:14px;font-size:18px;margin-top:8px}
#lista div{padding:10px;border-bottom:1px solid #333}
</style>
</head>

<body>
<div class="box">
  <input id="nomeBusca" placeholder="Digite o nome do produto">
  <div id="lista"></div>

  <button onclick="abrirLeitor()">ðŸ“· Ler cÃ³digo</button>
  <div id="leitor"></div>
</div>

<script>
const admin = JSON.parse(localStorage.getItem("admin_logado"));
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const input = document.getElementById("nomeBusca");
const lista = document.getElementById("lista");

/* ðŸ”¤ BUSCA POR NOME â€“ SOMENTE ISSO */
input.addEventListener("input", async () => {
  const v = input.value.trim();
  lista.innerHTML = "";
  if (v.length < 1) return;

  const { data } = await sb
    .from("produtos")
    .select("nome,preco")
    .ilike("nome", `%${v}%`)
    .eq("app_id", admin.app_id);

  data?.forEach(p=>{
    const d=document.createElement("div");
    d.textContent = p.nome;
    lista.appendChild(d);
  });
});

/* ðŸ“· LEITOR â€“ BUSCA POR CÃ“DIGO */
function abrirLeitor(){
  Quagga.init({
    inputStream:{type:"LiveStream",target:leitor},
    decoder:{readers:["ean_reader","code_128_reader"]}
  },()=>Quagga.start());

  Quagga.onDetected(async r=>{
    Quagga.stop();
    const codigo = r.codeResult.code;

    const { data } = await sb
      .from("produtos")
      .select("nome")
      .eq("codigo_barra", codigo)
      .eq("app_id", admin.app_id)
      .single();

    alert(data ? data.nome : "Produto nÃ£o encontrado");
  });
}
</script>
</body>
</html>
