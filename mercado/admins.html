<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin do Mercado</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#020617;color:#fff}
.topo{
  background:#0f172a;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:900px;
  margin:30px auto;
  padding:20px;
}
.card{
  background:#0f172a;
  padding:20px;
  border-radius:16px;
  margin-top:20px;
}
input,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
button{
  background:#22c55e;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
button.danger{
  background:#e53935;
  color:#fff;
}
button.sec{
  background:#2563eb;
  color:#fff;
}
.lista{
  margin-top:20px;
}
.item{
  background:#020617;
  padding:12px;
  border-radius:12px;
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
small{opacity:.7}
.links{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.actions{
  display:flex;
  flex-direction:column;
  gap:6px;
}
a{color:#22c55e;text-decoration:none}
</style>
</head>

<body>

<div class="topo">
  <h2>üè™ Admin do Mercado</h2>
  <button class="danger" onclick="logout()">Sair</button>
</div>

<div class="container">

<!-- CRIAR USU√ÅRIO -->
<div class="card">
  <h3>‚ûï Criar Usu√°rio do Mercado</h3>
  <input id="nome" placeholder="Nome">
  <input id="email" placeholder="Email / Usu√°rio">
  <input id="senha" type="password" placeholder="Senha">
  <select id="tipo">
    <option value="caixa">Caixa</option>
    <option value="produtos">Produtos / Estoque</option>
    <option value="admin">Admin do Mercado</option>
  </select>
  <button onclick="criarUsuario()">Criar Usu√°rio</button>
</div>

<!-- LISTA -->
<div class="card">
  <h3>üë• Usu√°rios do Mercado</h3>
  <div class="lista" id="listaUsuarios"></div>
</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

/* üîê sess√£o do admin */
const admin = JSON.parse(localStorage.getItem("admin_logado"));
if(!admin || !admin.app_id){
  window.location.href = "../auth/login.html";
}

/* app do mercado */
const APP_ID = admin.app_id;

/* üîó link de ativa√ß√£o (plano B ao QR) */
const LINK_ATIVACAO =
  "https://anajuliafarias659-cloud.github.io/ffsolucoes/mercado/login-funcionarios.html";

/* criar usu√°rio */
window.criarUsuario = async ()=>{
  await supabase.from("usuarios").insert({
    nome: nome.value,
    email: email.value,
    senha: senha.value,
    tipo: tipo.value,
    app_id: APP_ID,
    ativo: true
  });

  nome.value="";
  email.value="";
  senha.value="";
  carregarUsuarios();
};

/* listar usu√°rios */
async function carregarUsuarios(){
  const { data } = await supabase
    .from("usuarios")
    .select("*")
    .eq("app_id", APP_ID);

  listaUsuarios.innerHTML="";
  (data||[]).forEach(u=>{
    listaUsuarios.innerHTML += `
      <div class="item">
        <div>
          <b>${u.nome}</b><br>
          <small>${u.email} ‚Ä¢ ${u.tipo}</small>
          <div class="links">
            <small>
              üîó <a href="${LINK_ATIVACAO}" target="_blank">
                Link de ativa√ß√£o
              </a>
            </small>
          </div>
        </div>
        <div class="actions">
          <button class="sec" onclick="copiarLink()">Copiar link</button>
          <button class="danger" onclick="desativar('${u.id}')">Desativar</button>
        </div>
      </div>
    `;
  });
}

/* copiar link */
window.copiarLink = ()=>{
  navigator.clipboard.writeText(LINK_ATIVACAO);
  alert("Link de ativa√ß√£o copiado!");
};

/* desativar */
window.desativar = async id=>{
  if(confirm("Desativar usu√°rio?")){
    await supabase.from("usuarios")
      .update({ativo:false})
      .eq("id",id);
    carregarUsuarios();
  }
};

/* logout */
window.logout = ()=>{
  localStorage.removeItem("admin_logado");
  window.location.href = "../auth/login.html";
};

carregarUsuarios();
</script>

</body>
</html>
