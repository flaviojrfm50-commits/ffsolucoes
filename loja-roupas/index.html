<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Loja de Roupas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#020617;color:#fff}

/* BANNER */
.banner{
  width:100%;
  height:260px;
  background:#0f172a;
  display:flex;
  align-items:center;
  justify-content:center;
}
.banner img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.topo{
  background:#020617;
  padding:20px;
  text-align:center;
}

.container{max-width:1200px;margin:30px auto;padding:0 20px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:18px;
}

.card{
  background:#0f172a;
  border-radius:16px;
  padding:14px;
  text-align:center;
}

.card img{
  width:100%;
  height:180px;
  object-fit:cover;
  border-radius:12px;
}

.preco{color:#22c55e;font-weight:bold}
small{opacity:.7}
</style>
</head>

<body>

<!-- BANNER -->
<div id="banner" class="banner"></div>

<div class="topo">
  <h1 id="nomeLoja">ðŸ‘• Loja de Roupas</h1>
  <p id="descLoja">Confira nossas peÃ§as disponÃ­veis</p>
</div>

<div class="container">
  <div id="produtos" class="grid"></div>
</div>

<script>
/* ========= SUPABASE ========= */
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

/* ========= APP_ID ========= */
const params = new URLSearchParams(window.location.search);
const APP_ID = params.get("app");

if(!APP_ID){
  document.body.innerHTML = "<h2 style='padding:20px'>App nÃ£o informado</h2>";
  throw new Error("app_id ausente");
}

/* ========= BANNER / CONFIG ========= */
async function carregarConfig(){
  const { data } = await sb
    .from("config_site")
    .select("nome_site,descricao_site,banner_url")
    .eq("app_id", APP_ID)
    .maybeSingle();

  if(!data) return;

  if(data.banner_url){
    const banner = document.getElementById("banner");
    banner.innerHTML = `<img src="${data.banner_url}">`;
  }

  if(data.nome_site){
    document.getElementById("nomeLoja").innerText = data.nome_site;
  }

  if(data.descricao_site){
    document.getElementById("descLoja").innerText = data.descricao_site;
  }
}

/* ========= PRODUTOS ========= */
async function carregarProdutos(){
  const { data } = await sb
    .from("produtos")
    .select("*")
    .eq("ativo", true)
    .eq("app_id", APP_ID);

  const produtosEl = document.getElementById("produtos");
  produtosEl.innerHTML = (data || []).map(p=>`
    <div class="card">
      ${p.imagem ? `<img src="${p.imagem}">` : ""}
      <b>${p.nome}</b>
      <div class="preco">R$ ${p.preco.toFixed(2)}</div>
      <small>${p.categoria}</small>
    </div>
  `).join("");
}

carregarConfig();
carregarProdutos();
</script>


</body>
</html>
