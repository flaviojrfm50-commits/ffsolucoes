<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Loja</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ===== TODO O CSS ORIGINAL — NÃO ALTERADO ===== */
*{box-sizing:border-box}
body{margin:0;font-family:Arial,sans-serif;background:#020617;color:#fff}
:root{--cor-primaria:#22c55e;--cor-banner:#0f172a;--cor-card:#0f172a}
body.ano_novo{--cor-primaria:#22c55e;--cor-banner:#064e3b;--cor-card:#052e16}
body.sao_joao{--cor-primaria:#f59e0b;--cor-banner:#78350f;--cor-card:#451a03}
body.carnaval{--cor-primaria:#a855f7;--cor-banner:#3b0764;--cor-card:#2e1065}
body.natal{--cor-primaria:#ef4444;--cor-banner:#7f1d1d;--cor-card:#450a0a}

.banner{width:100%;height:260px;background:var(--cor-banner)}
.banner img{width:100%;height:100%;object-fit:cover}
.topo{padding:24px;text-align:center;background:var(--cor-banner)}
.container{padding:20px;max-width:1200px;margin:auto}
.grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.card{background:var(--cor-card);border-radius:14px;padding:12px;text-align:center}
.card img{width:100%;height:160px;object-fit:cover;border-radius:10px}
.botao{margin-top:8px;width:100%;padding:10px;border:none;border-radius:10px;background:var(--cor-primaria);font-weight:bold;cursor:pointer}
</style>
</head>

<body>

<div id="banner" class="banner"></div>

<div class="topo">
  <h1 id="nomeLoja">Loja</h1>
  <p id="descLoja"></p>
</div>

<div class="container">
  <div id="produtos" class="grid"></div>
</div>

<script>
/* ===== SUPABASE ===== */
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const params = new URLSearchParams(location.search);
let APP_ID = params.get("app") || localStorage.getItem("APP_ID");
if(!APP_ID){ document.body.innerHTML="Link inválido"; throw new Error(); }
localStorage.setItem("APP_ID", APP_ID);

async function init(){
  const { data: cfg } = await sb.from("config_site")
    .select("nome_site, descricao_site, banner_url, tema")
    .eq("app_id", APP_ID).single();

  nomeLoja.innerText = cfg.nome_site;
  descLoja.innerText = cfg.descricao_site || "";
  document.body.className = cfg.tema || "";
  banner.innerHTML = cfg.banner_url ? `<img src="${cfg.banner_url}">` : "";

  const { data } = await sb.from("produtos")
    .select("*")
    .eq("ativo", true)
    .eq("app_id", APP_ID);

  produtos.innerHTML = data.map(p=>{
    /* ===== ÚNICO AJUSTE (IMAGEM DO CELULAR) ===== */
    let imgs = [];
    try{
      if(Array.isArray(p.imagens)) imgs = p.imagens;
      else if(typeof p.imagens === "string") imgs = JSON.parse(p.imagens);
      else if(p.imagem) imgs = [p.imagem];
    }catch(e){ imgs = []; }

    const capa = imgs[0] || "";

    return `
      <div class="card">
        ${capa ? `<img src="${capa}" loading="lazy">` : ""}
        <b>${p.nome}</b><br>
        R$ ${p.preco.toFixed(2)}
        <button class="botao" onclick='add(${JSON.stringify(p)})'>Adicionar</button>
      </div>
    `;
  }).join("");
}

init();
</script>

</body>
</html>
