<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Configurações do Site</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#020617;
  color:#fff;
}
header{
  background:#0f172a;
  padding:16px 24px;
}
main{
  padding:24px;
  max-width:800px;
  margin:auto;
}
.card{
  background:#0f172a;
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}
input, textarea{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:6px;
  margin-bottom:12px;
}
button{
  background:#22c55e;
  color:#020617;
  border:none;
  padding:12px 18px;
  border-radius:10px;
  cursor:pointer;
  font-weight:bold;
}
small{
  opacity:.6;
}
</style>
</head>

<body>

<header>
  <h2>⚙️ Configurações do Site Institucional</h2>
</header>

<main>

  <div class="card">
    <h3>Informações do Estabelecimento</h3>

    <label>Nome do estabelecimento</label>
    <input id="nome">

    <label>Slogan / descrição curta</label>
    <textarea id="descricao"></textarea>

    <label>WhatsApp (apenas números)</label>
    <input id="whatsapp">

    <label>Endereço</label>
    <input id="endereco">

    <label>Instagram</label>
    <input id="instagram">

    <label>Facebook</label>
    <input id="facebook">

    <button onclick="salvar()">Salvar configurações</button>
    <br><br>
    <small>* Essas informações aparecem apenas no site institucional</small>
  </div>

</main>

<script>
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const app_id = localStorage.getItem("app_id");

async function salvar(){
  const payload = {
    app_id,
    nome: nome.value,
    descricao: descricao.value,
    whatsapp: whatsapp.value,
    endereco: endereco.value,
    instagram: instagram.value,
    facebook: facebook.value
  };

  await sb.from("site_config")
    .upsert(payload, { onConflict: "app_id" });

  alert("Configurações salvas com sucesso!");
}

async function carregar(){
  const { data } = await sb
    .from("site_config")
    .select("*")
    .eq("app_id", app_id)
    .single();

  if(!data) return;

  nome.value = data.nome || "";
  descricao.value = data.descricao || "";
  whatsapp.value = data.whatsapp || "";
  endereco.value = data.endereco || "";
  instagram.value = data.instagram || "";
  facebook.value = data.facebook || "";
}

const nome = document.getElementById("nome");
const descricao = document.getElementById("descricao");
const whatsapp = document.getElementById("whatsapp");
const endereco = document.getElementById("endereco");
const instagram = document.getElementById("instagram");
const facebook = document.getElementById("facebook");

carregar();
</script>

</body>
</html>

