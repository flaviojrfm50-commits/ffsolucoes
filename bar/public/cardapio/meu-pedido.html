<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meu Pedido</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<h2>ğŸ§¾ Meu pedido</h2>
<div id="lista"></div>
<h3 id="total"></h3>

<button onclick="pedirConta()">ğŸ§¾ Pedir minha conta</button>

<script>
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const params = new URLSearchParams(location.search);
const pedido_id = params.get("pedido");
const app_id = params.get("app_id");

async function carregar(){
  const { data } = await sb
    .from("pedido_itens")
    .select("*")
    .eq("pedido_id",pedido_id);

  let total = 0;
  const div = document.getElementById("lista");
  div.innerHTML="";

  data.forEach(i=>{
    total += i.preco * i.quantidade;
    div.innerHTML+=`${i.nome_produto} x${i.quantidade}<br>`;
  });

  document.getElementById("total").innerText =
    `Total: R$ ${total.toFixed(2)}`;
}

async function pedirConta(){
  await sb.from("pedidos")
    .update({status:"conta_solicitada"})
    .eq("id",pedido_id);

  alert("Conta solicitada ğŸ‘");
}

carregar();
</script>

</body>
</html>
