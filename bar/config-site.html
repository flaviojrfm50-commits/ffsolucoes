<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Site Público</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --primary:#22c55e;
  --bg:#020617;
  --text:#ffffff;
  --muted:#94a3b8;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui;}
body{background:var(--bg);color:var(--text);}
.hero{
  min-height:60vh;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
h1{font-size:2.4rem;}
p{margin-top:10px;color:var(--muted);}
</style>
</head>

<body>

<section class="hero">
  <div>
    <h1 id="titulo">Carregando…</h1>
    <p id="subtitulo">Site público</p>
  </div>
</section>

<script>
// ================= SUPABASE =================
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

// ================= UUID DA URL (ROBUSTO) =================
const params = new URLSearchParams(location.search);

// 1️⃣ tenta app_id
let site_id = params.get("app_id");

// 2️⃣ fallback: primeiro parâmetro cru
if(!site_id){
  const raw = location.search.replace("?", "").split("&")[0];
  if(raw){
    // se vier tipo app=UUID → pega só o UUID
    site_id = raw.includes("=") ? raw.split("=")[1] : raw;
  }
}

// validação final
if(!site_id || site_id.length < 30){
  document.getElementById("titulo").innerText = "Site indisponível";
  document.getElementById("subtitulo").innerText = "URL inválida";
  throw new Error("UUID inválido");
}

// ================= LOAD SITE =================
(async()=>{
  const { data, error } = await sb
    .from("sites")
    .select("id,name")
    .eq("id", site_id)
    .maybeSingle();

  if(error || !data){
    document.getElementById("titulo").innerText = "Site indisponível";
    document.getElementById("subtitulo").innerText = "Configuração não encontrada";
    return;
  }

  document.getElementById("titulo").innerText = data.name;
})();
</script>

</body>
</html>
